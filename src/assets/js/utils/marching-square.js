const ceil=Math.ceil,max=Math.max;class MarchingSquare{constructor(a){const b={fn:"Function",threshold:"Number",steps:"Number",width:"Number",height:"Number",join:"Boolean",more:"Number"};var c="[MarchingSquare] constructor must accept a valid 'settings' object: {\n";if(Object.entries(b).forEach(function(a){c+="\t"+a[0]+": "+a[1]+",\n"}),c+="}\n",void 0===a||!Object.keys(a).length)throw new Error(c);else Object.entries(b).forEach(function(b){if(void 0===a[b[0]])throw c+="=> '"+b[0]+"' is undefined \n",new Error(c);else if(typeof a[b[0]]!==b[1].toLowerCase())throw c+="=> typeof '"+b[0]+"' was found to be '"+typeof a[b[0]]+"'\n",new Error(c)});this.fn=a.fn,this.threshold=a.threshold,this.steps=0|a.steps,this.width=0|a.width,this.height=0|a.height,this.join=a.join,this.more=0|a.more,this.points=[]}finePos(a,b,c,d){return(this.threshold-(c*b-d*a)/(b-a))/((d-c)/(b-a))}finePosOpt(a,b,c,d){return 0|b*(this.threshold-c*(a+1)+d*a)/(d-c)}loop(){this.points=[];let a,b;const c=0|ceil(this.width/this.steps),d=0|ceil(this.height/this.steps),e=this.more;this.steps+=2*e;const f=new Float32Array((this.steps+1)*(this.steps+1));for(a=0|this.steps+1;a--;)for(b=0|this.steps+1;b--;){const g=this.fn((a-e)*c,(b-e)*d);f[a+this.steps*b]=g}for(a=0|this.steps;a--;)for(b=0|this.steps;b--;){let g,h,i,j,k,l,m,n;const o=f[a+this.steps*b],p=f[a+1+this.steps*b],q=f[a+1+this.steps*(b+1)],r=f[a+this.steps*(b+1)];let s=0;s+=(0|max(ceil(o-this.threshold),0))<<3,s+=(0|max(ceil(p-this.threshold),0))<<2,s+=(0|max(ceil(q-this.threshold),0))<<1,s+=(0|max(ceil(r-this.threshold),0))<<0;let t=!0,u=!1;switch(s){case 1:case 14:g=a*c,h=this.finePosOpt(b,d,o,r),i=this.finePosOpt(a,c,r,q),j=(b+1)*d;break;case 2:case 13:g=this.finePosOpt(a,c,r,q),h=(b+1)*d,i=(a+1)*c,j=this.finePosOpt(b,d,p,q);break;case 4:case 11:g=this.finePosOpt(a,c,o,p),h=b*d,i=(a+1)*c,j=this.finePosOpt(b,d,p,q);break;case 7:case 8:g=this.finePosOpt(a,c,o,p),h=b*d,i=a*c,j=this.finePosOpt(b,d,o,r);break;case 3:case 12:g=a*c,h=this.finePosOpt(b,d,o,r),i=(a+1)*c,j=this.finePosOpt(b,d,p,q);break;case 6:case 9:g=this.finePosOpt(a,c,o,p),h=b*d,i=this.finePosOpt(a,c,r,q),j=(b+1)*d;break;case 5:case 10:u=!0,g=a*c,h=this.finePosOpt(b,d,o,r),i=this.finePosOpt(a,c,r,q),j=(b+1)*d,k=this.finePosOpt(a,c,o,p),l=b*d,m=(a+1)*c,n=this.finePosOpt(b,d,p,q);break;case 0:case 15:default:t=!1;}t&&(g!==i||h!==j)&&(this.points=this.points.concat([{x:g-e*c,y:h-e*d,cas:s},{x:i-e*c,y:j-e*d,cas:s}])),u&&(k!==m||l!==n)&&(this.points=this.points.concat([{x:k-e*c,y:l-e*d,cas:s},{x:m-e*c,y:n-e*d,cas:s}]))}}}export default MarchingSquare;